<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runde 4</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Runde 4</h1>
        <button class="btn btn-secondary mb-4" onclick="goBack()">Zurück zur Hauptseite</button>
        <div class="input-group mb-3">
            <input type="text" id="numberInput" class="form-control" placeholder="Zahl eingeben">
            <div class="input-group-append">
                <button class="btn btn-primary" onclick="highlightNumbers()">Markieren</button>
            </div>
        </div>
        <button class="btn btn-secondary mb-4" onclick="removeHighlights()">Markierungen entfernen</button>

        <div id="content" class="mb-4">
            <p>Hier sind einige Zahlen: 123, 456, 789. Versuchen Sie eine dieser Zahlen einzugeben.</p>
            <p>Weitere Zahlen: 101, 202, 303, 404, 505. Markieren Sie diese ebenfalls.</p>
        </div>

        <h2 class="mb-4">5x5 Tabellen</h2>

        <div id="tablesContainer" class="d-flex flex-wrap">
            <!-- Initiale Tabellen -->

            <div class="table-container initial-table">
                <h4>1</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>10</td>
                        <td>28</td>
                        <td>31</td>
                        <td>53</td>
                        <td>71</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>27</td>
                        <td>33</td>
                        <td>58</td>
                        <td>61</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>25</td>
                        <td class="highlight">FINCA</td>
                        <td>54</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>16</td>
                        <td>32</td>
                        <td>45</td>
                        <td>55</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>30</td>
                        <td>35</td>
                        <td>48</td>
                        <td>75</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>1</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>9</td>
                        <td>21</td>
                        <td>36</td>
                        <td>59</td>
                        <td>67</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>28</td>
                        <td>37</td>
                        <td>57</td>
                        <td>72</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>20</td>
                        <td class="highlight">FINCA</td>
                        <td>47</td>
                        <td>70</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>22</td>
                        <td>42</td>
                        <td>46</td>
                        <td>65</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>24</td>
                        <td>31</td>
                        <td>53</td>
                        <td>75</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>1</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>1</td>
                        <td>22</td>
                        <td>40</td>
                        <td>59</td>
                        <td>74</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>27</td>
                        <td>34</td>
                        <td>55</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>23</td>
                        <td class="highlight">FINCA</td>
                        <td>51</td>
                        <td>63</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>24</td>
                        <td>37</td>
                        <td>54</td>
                        <td>72</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>16</td>
                        <td>33</td>
                        <td>58</td>
                        <td>68</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>2</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>11</td>
                        <td>30</td>
                        <td>33</td>
                        <td>60</td>
                        <td>63</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>29</td>
                        <td>39</td>
                        <td>53</td>
                        <td>74</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>16</td>
                        <td class="highlight">FINCA</td>
                        <td>47</td>
                        <td>65</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>27</td>
                        <td>43</td>
                        <td>52</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>20</td>
                        <td>34</td>
                        <td>48</td>
                        <td>75</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>2</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>15</td>
                        <td>28</td>
                        <td>44</td>
                        <td>49</td>
                        <td>64</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>18</td>
                        <td>37</td>
                        <td>57</td>
                        <td>67</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>30</td>
                        <td class="highlight">FINCA</td>
                        <td>53</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>20</td>
                        <td>36</td>
                        <td>51</td>
                        <td>73</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>29</td>
                        <td>38</td>
                        <td>56</td>
                        <td>69</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>2</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>5</td>
                        <td>22</td>
                        <td>44</td>
                        <td>55</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>17</td>
                        <td>31</td>
                        <td>47</td>
                        <td>68</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>28</td>
                        <td class="highlight">FINCA</td>
                        <td>53</td>
                        <td>72</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>19</td>
                        <td>37</td>
                        <td>60</td>
                        <td>61</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>16</td>
                        <td>36</td>
                        <td>58</td>
                        <td>71</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>3</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>3</td>
                        <td>17</td>
                        <td>41</td>
                        <td>49</td>
                        <td>61</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>23</td>
                        <td>36</td>
                        <td>53</td>
                        <td>74</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>25</td>
                        <td class="highlight">FINCA</td>
                        <td>50</td>
                        <td>66</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>22</td>
                        <td>40</td>
                        <td>46</td>
                        <td>68</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>16</td>
                        <td>43</td>
                        <td>60</td>
                        <td>64</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>3</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>10</td>
                        <td>28</td>
                        <td>32</td>
                        <td>50</td>
                        <td>73</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>27</td>
                        <td>31</td>
                        <td>51</td>
                        <td>66</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>20</td>
                        <td class="highlight">FINCA</td>
                        <td>57</td>
                        <td>74</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>21</td>
                        <td>35</td>
                        <td>55</td>
                        <td>70</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>30</td>
                        <td>34</td>
                        <td>58</td>
                        <td>61</td>
                    </tr>
                </table>
            </div>
            <div class="table-container initial-table">
                <h4>3</h4>
                <table class="table table-bordered table-striped">
                    <tr>
                        <td>5</td>
                        <td>27</td>
                        <td>35</td>
                        <td>50</td>
                        <td>61</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>16</td>
                        <td>41</td>
                        <td>58</td>
                        <td>75</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>18</td>
                        <td class="highlight">FINCA</td>
                        <td>47</td>
                        <td>62</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>19</td>
                        <td>32</td>
                        <td>60</td>
                        <td>72</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>22</td>
                        <td>36</td>
                        <td>55</td>
                        <td>70</td>
                    </tr>
                </table>
            </div>
        </div>


        <h3 class="mb-3">Neue Tabelle hinzufügen</h3>
        <input type="text" id="newTableName" class="form-control mb-3" placeholder="Tabellenname eingeben">
        <textarea id="newTableData" class="form-control mb-3" placeholder='Fügen Sie eine neue 5x5-Tabelle in folgendem Format hinzu: [["1", "2", "3", "4", "5"], ["6", "7", "8", "9", "10"], ["11", "12", "13", "14", "15"], ["16", "17", "18", "19", "20"], ["21", "22", "23", "24", "25"]]'></textarea>
        <button class="btn btn-success" onclick="addNewTable()">Tabelle hinzufügen</button>
    </div>

    <script>
        const roundKey = 'tables_round4'; // Change this key for each round page
        const highlightsKey = 'highlights_round4'; // Key for storing highlights

        document.addEventListener('DOMContentLoaded', () => {
            // Initiale Daten
            const initialData = [{
                "card": [
                    ["0", "0", "0", "0", "0"],
                    ["2", "18", "40", "49", "69"],
                    ["13", "22", "FINCA", "60", "73"],
                    ["1", "27", "37", "47", "70"],
                    ["6", "28", "45", "53", "71"]
                ],
                "round_number": 1,
                "page_number": 1,
                "name": "Initiale Tabelle"
            }];

            // Lade gespeicherte Tabellen oder verwende initiale Daten
            const storedData = JSON.parse(localStorage.getItem(roundKey)) || initialData;

            // Fülle die Tabelle mit den gespeicherten Daten
            storedData.forEach((tableData, index) => {
                addTableToDOM(tableData.card, tableData.name, index);
            });

            // Event-Listener für Enter-Taste hinzufügen
            document.getElementById('numberInput').addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    highlightNumbers();
                }
            });

            // Restore highlights from local storage
            restoreHighlights();
        });

        function highlightNumbers() {
            // Hole die eingegebene Zahl
            const inputElement = document.getElementById('numberInput');
            const input = inputElement.value.trim();

            if (input) {
                // Finde und markiere alle Vorkommen der Zahl im Textbereich
                const content = document.getElementById('content');
                const regex = new RegExp(`\\b${input}\\b`, 'g');

                content.innerHTML = content.innerHTML.replace(regex, '<span class="highlight">$&</span>');

                // Markiere Zahlen in allen Tabellen
                const cells = document.querySelectorAll('#tablesContainer td');
                cells.forEach(cell => {
                    if (cell.textContent === input) {
                        cell.classList.add('highlight');
                    }
                });

                // Speichere hervorgehobene Zahlen
                saveHighlightedNumber(input);

                // Leere das Eingabefeld
                inputElement.value = '';
            }
        }

        function removeHighlights() {
            const content = document.getElementById('content');
            content.innerHTML = content.innerHTML.replace(/<span class="highlight">([^<]*)<\/span>/g, '$1');

            // Entferne Hervorhebungen aus allen Tabellen
            const cells = document.querySelectorAll('#tablesContainer td');
            cells.forEach(cell => {
                cell.classList.remove('highlight');
            });

            // Leere hervorgehobene Zahlen aus dem lokalen Speicher
            localStorage.removeItem(highlightsKey);
        }

        function addNewTable() {
            const newTableName = document.getElementById('newTableName').value.trim();
            const newTableData = document.getElementById('newTableData').value.trim();

            if (newTableName && newTableData) {
                try {
                    let tableArray;
                    if (newTableData.startsWith('[')) {
                        // Parse as JSON
                        tableArray = JSON.parse(newTableData);
                    } else {
                        // Parse as space-separated values
                        tableArray = newTableData.split('\n').map(row => row.trim().split(/\s+/));
                    }

                    if (tableArray.length === 5 && tableArray.every(row => row.length === 5)) {
                        const storedData = JSON.parse(localStorage.getItem(roundKey)) || [];
                        storedData.push({
                            card: tableArray,
                            round_number: storedData.length + 1,
                            page_number: 1,
                            name: newTableName
                        });
                        localStorage.setItem(roundKey, JSON.stringify(storedData));
                        addTableToDOM(tableArray, newTableName, storedData.length - 1);
                        document.getElementById('newTableName').value = '';
                        document.getElementById('newTableData').value = '';
                    } else {
                        alert('Die Tabelle muss 5x5 sein.');
                    }
                } catch (e) {
                    alert('Ungültiges Format. Bitte geben Sie eine gültige 5x5-Tabelle im JSON-Format oder als Leerzeichen-getrennte Werte ein.');
                }
            } else {
                alert('Bitte geben Sie einen Tabellennamen und Daten ein.');
            }
        }

        function addTableToDOM(tableData, tableName, index) {
            const tablesContainer = document.getElementById('tablesContainer');
            const tableContainer = document.createElement('div');
            tableContainer.classList.add('table-container');
            tableContainer.id = `table-container-${index}`;

            if (tableName) {
                const tableNameElement = document.createElement('h4');
                tableNameElement.textContent = tableName;
                tableContainer.appendChild(tableNameElement);
            }

            const table = document.createElement('table');
            table.id = `table-${index}`;
            table.classList.add('table', 'table-bordered', 'table-striped');

            tableData.forEach((row, rowIndex) => {
                let tr = document.createElement('tr');
                row.forEach((cell, colIndex) => {
                    let td = document.createElement('td');
                    td.textContent = cell;
                    if (rowIndex === 2 && colIndex === 2) { // Middle cell
                        td.classList.add('highlight');
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Löschen';
            deleteButton.classList.add('btn', 'btn-danger', 'delete-btn');
            deleteButton.onclick = () => {
                deleteTable(index);
            };

            tableContainer.appendChild(table);
            tableContainer.appendChild(deleteButton);
            tablesContainer.appendChild(tableContainer);
        }

        function deleteTable(index) {
            // Entferne die Tabelle aus dem DOM
            const tableContainer = document.getElementById(`table-container-${index}`);
            if (tableContainer) {
                tableContainer.remove();
            }

            // Aktualisiere die gespeicherten Daten
            let storedData = JSON.parse(localStorage.getItem(roundKey));
            storedData.splice(index, 1);
            localStorage.setItem(roundKey, JSON.stringify(storedData));

            // Entferne alle dynamisch hinzugefügten Tabellen aus dem DOM
            const tablesContainer = document.getElementById('tablesContainer');
            tablesContainer.querySelectorAll('.table-container:not(.initial-table)').forEach(node => node.remove());

            // Füge alle verbleibenden Tabellen wieder zum DOM hinzu
            storedData.forEach((tableData, newIndex) => {
                addTableToDOM(tableData.card, tableData.name, newIndex);
            });
        }

        function saveHighlightedNumber(number) {
            let highlightedNumbers = JSON.parse(localStorage.getItem(highlightsKey)) || [];
            if (!highlightedNumbers.includes(number)) {
                highlightedNumbers.push(number);
                localStorage.setItem(highlightsKey, JSON.stringify(highlightedNumbers));
            }
        }

        function restoreHighlights() {
            const highlightedNumbers = JSON.parse(localStorage.getItem(highlightsKey)) || [];
            highlightedNumbers.forEach(number => {
                const regex = new RegExp(`\\b${number}\\b`, 'g');

                // Finde und markiere alle Vorkommen der Zahl im Textbereich
                const content = document.getElementById('content');
                content.innerHTML = content.innerHTML.replace(regex, '<span class="highlight">$&</span>');

                // Markiere Zahlen in allen Tabellen
                const cells = document.querySelectorAll('#tablesContainer td');
                cells.forEach(cell => {
                    if (cell.textContent === number) {
                        cell.classList.add('highlight');
                    }
                });
            });

            // Markiere mittlere Zelle in jeder Tabelle
            const tables = document.querySelectorAll('table');
            tables.forEach(table => {
                const middleCell = table.rows[2].cells[2];
                middleCell.classList.add('highlight');
            });
        }

        function goBack() {
            window.location.href = 'index.html';
        }

    </script>
</body>

</html>
